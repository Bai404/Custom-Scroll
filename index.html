<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>自定义滚动条 </title>
    <link rel="stylesheet" href="resource/reset.css">
    <script src="resource/jquery-3.3.1.js"></script>
    <style type="text/css" media="screen">
        body{
            background-color: #eee;
        }
        .scroll-demo{
            width: 540px;
            margin:50px auto;
            border:1px solid #999;
        }
        /* 标签切换区 */
        .scroll-tab{
            height: 34px;
            border-bottom:1px solid #999;
            color:#666;
            background-color: #f8f8f8;
        }
        .scroll-tab .tab-item{
            line-height:34px;
            text-align: center;
            height: 34px;
            float: left;
            border-right:1px solid #999;
            padding:0 20px;
        }
        .scroll-tab .tab-active{
            border-top:2px solid green;
            color:green;
            margin:-1px 0;
        }
        /* 滚动内容区 */
        .srcoll-wrap{
            position: relative;
            width: 100%;
            height: 300px;
        }
        .srcoll-wrap .scroll-cont{
            height: 100%;
            padding: 0 15px;
            overflow: hidden;
        }
        .srcoll-wrap .scroll-cont h3{
            text-align: center;
            font:16px;
            line-height: 3em;
        }
        .srcoll-wrap .scroll-cont p{
            text-indent: 2em;
            font-size:14px;
            line-height: 20px;
            margin-bottom: 10px;
            padding-bottom: 1px;
        }
        /* 滚动条 */
        .srcoll-wrap .scroll-bar{
            position: absolute;
            top: 0;
            right: 0;
            width: 10px;
            height: 100%;
            background-color: #e6e6e6;
        }
        .srcoll-wrap .scroll-bar .scroll-slider{
            position: absolute;
            top: 0;
            left: 1px;
            width: 8px;
            height: 30px;
            background-color: green;
        }
    </style>
</head>
<body>
    <!-- 案例容器 -->
    <div class="scroll-demo">
        <!-- 标签切换区 -->
        <ul class="scroll-tab">
            <li class="tab-item tab-active clear">第一篇</li>
            <li class="tab-item">第2篇</li>
            <li class="tab-item">第3篇</li>
            <li class="tab-item">第4篇</li>
        </ul>
        <!-- 滚动内容区 -->
        <div class="srcoll-wrap">
            <!-- 滚动内容 -->
            <div class="scroll-cont">
                <h3 class="anchor">亚洲杯沙特2-0黎巴嫩</h3>
                <div class="scroll-ol">
                    <p>亚洲杯沙特第二场比赛，面对黎巴嫩的密集防守，刻意防反，仍然能顺利攻破对方城池，2-0，取得这场胜利。这场胜利表明，沙特绝对不可小视，非常低调，或者是由于很多球员都不是大家熟悉，名字已经比较难记住，而且在亚冠也比较少发光发热，但是沙特绝对是一支强队，两连胜，已经晋级16强，他们将会在下一轮跟卡塔尔争小组第一。</p>
                    <p>亚洲杯沙特第二场比赛，面对黎巴嫩的密集防守，刻意防反，仍然能顺利攻破对方城池，2-0，取得这场胜利。这场胜利表明，沙特绝对不可小视，非常低调，或者是由于很多球员都不是大家熟悉，名字已经比较难记住，而且在亚冠也比较少发光发热，但是沙特绝对是一支强队，两连胜，已经晋级16强，他们将会在下一轮跟卡塔尔争小组第一
                    </p>
                    <p>
                        亚洲杯沙特第二场比赛，面对黎巴嫩的密集防守，刻意防反，仍然能顺利攻破对方城池，2-0，取得这场胜利。这场胜利表明，沙特绝对不可小视，非常低调，或者是由于很多球员都不是大家熟悉，名字已经比较难记住，而且在亚冠也比较少发光发热，但是沙特绝对是一支强队，两连胜，已经晋级16强，他们将会在下一轮跟卡塔尔争小组第一。
                    </p>
                </div>
                <h3 class="anchor">轮跟卡塔尔争</h3>
                <div class="scroll-ol">
                    <p>亚洲杯沙特第二场比赛，面对黎巴嫩的密集防守，刻意防反，仍然能顺利攻破对方城池，2-0，取得这场胜利。这场胜利表明，沙特绝对不可小视，非常低调，或者是由于很多球员都不是大家熟悉，名字已经比较难记住，而且在亚冠也比较少发光发热，但是沙特绝对是一支强队，两连胜，已经晋级16强，他们将会在下一轮跟卡塔尔争小组第一。</p>
                    <p>亚洲杯沙特第二场比赛，面对黎巴嫩的密集防守，刻意防反，仍然能顺利攻破对方城池，2-0，取得这场胜利。这场胜利表明，沙特绝对不可小视，非常低调，或者是由于很多球员都不是大家熟悉，名字已经比较难记住，而且在亚冠也比较少发光发热，但是沙特绝对是一支强队，两连胜，已经晋级16强，他们将会在下一轮跟卡塔尔争小组第一
                    </p>
                    <p>
                        亚洲杯沙特第二场比赛，面对黎巴嫩的密集防守，刻意防反，仍然能顺利攻破对方城池，2-0，取得这场胜利。这场胜利表明，沙特绝对不可小视，非常低调，或者是由于很多球员都不是大家熟悉，名字已经比较难记住，而且在亚冠也比较少发光发热，但是沙特绝对是一支强队，两连胜，已经晋级16强，他们将会在下一轮跟卡塔尔争小组第一。
                    </p>
                </div>
                <h3 class="anchor">7队晋级16强</h3>
                <div class="scroll-ol">
                    <p>亚洲杯沙特第二场比赛，面对黎巴嫩的密集防守，刻意防反，仍然能顺利攻破对方城池，2-0，取得这场胜利。这场胜利表明，沙特绝对不可小视，非常低调，或者是由于很多球员都不是大家熟悉，名字已经比较难记住，而且在亚冠也比较少发光发热，但是沙特绝对是一支强队，两连胜，已经晋级16强，他们将会在下一轮跟卡塔尔争小组第一。</p>
                    <p>亚洲杯沙特第二场比赛，面对黎巴嫩的密集防守，刻意防反，仍然能顺利攻破对方城池，2-0，取得这场胜利。这场胜利表明，沙特绝对不可小视，非常低调，或者是由于很多球员都不是大家熟悉，名字已经比较难记住，而且在亚冠也比较少发光发热，但是沙特绝对是一支强队，两连胜，已经晋级16强，他们将会在下一轮跟卡塔尔争小组第一
                    </p>
                    <p>
                        亚洲杯沙特第二场比赛，面对黎巴嫩的密集防守，刻意防反，仍然能顺利攻破对方城池，2-0，取得这场胜利。这场胜利表明，沙特绝对不可小视，非常低调，或者是由于很多球员都不是大家熟悉，名字已经比较难记住，而且在亚冠也比较少发光发热，但是沙特绝对是一支强队，两连胜，已经晋级16强，他们将会在下一轮跟卡塔尔争小组第一。
                    </p>
                </div>
                <h3 class="anchor">沙特两连胜晋级。</h3>
                <div class="scroll-ol">
                    <p>
                        亚洲杯沙特第二场比赛，面对黎巴嫩的密集防守，刻意防反，仍然能顺利攻破对方城池，2-0，取得这场胜利。这场胜利表明，沙特绝对不可小视，非常低调，或者是由于很多球员都不是大家熟悉，名字已经比较难记住，而且在亚冠也比较少发光发热，但是沙特绝对是一支强队，两连胜，已经晋级16强，他们将会在下一轮跟卡塔尔争小组第一。
                    </p>
                </div>
                <div class="correct-bot"></div>
            </div>
            <!-- 滚动条 -->
            <div class="scroll-bar">
                <!-- 滚动滑块  -->
                <div class="scroll-slider"></div>
            </div>
        </div>
    </div>
<script type="text/javascript">
    var srcoll={};
    (function(win,doc,$){
        function cusScrollBar(options){
            this._init(options);
        }

        $.extend(cusScrollBar.prototype,{
            _init:function(options){
                var self=this;
                self.options={
                    scrollDir:"y",//滚动的方向
                    contSelector:"",//滚动内容区选择器
                    barSelector:"",//滚动条选择器
                    sliderSelector:"",//滚动滑块选择器
                    tabItemSelector:".tab-item",//标签选择器
                    tabActiveClass:"tab-active",//选中标签类名
                    anchorSelector:".anchor",//锚点选择器
                    correctSelector:".correct-bot",//矫正选择器
                    articleSelector:".scroll-ol",//文章选择器
                    wheelStep:10
                }
                $.extend(true,self.options,options||{})
                self._initDomEvent();
                return self;
            },
            // 初始化DOM引用
            _initDomEvent:function(){
                var opts=this.options;
                //滚动内容对象，必填项
                this.$cont=$(opts.contSelector);
                //滚动条滑块对象，必填项
                this.$slider=$(opts.sliderSelector);
                //滚动条对象
                this.$bar=opts.barSelector?$(opts.barSelector):self.$slider.parent( );
                //标签项
                this.$tabItem=$(opts.tabItemSelector);
                //锚点对象
                this.$anchor=$(opts.anchorSelector);
                //矫正对象
                this.$correct=$(opts.correctSelector);
                //文章对象
                this.$article=$(opts.articleSelector);
                //文档对象
                this.$doc=$(doc);

                this._initArticleHeight()._initSliderDragEvent()._initTabEvent()._bindContScroll()._bindMouseWheel();
            },
            /*初始化文档高度*/
            _initArticleHeight:function(){
                var self=this,
                lastArticle=self.$article.last();
                var lastArticleHeight=lastArticle.height(),
                    contHeight=self.$cont.height();
                if(lastArticleHeight<contHeight){
                    self.$correct[0].style.height=contHeight-lastArticleHeight-self.$anchor.outerHeight()+"px"
                }
                return self;
            },
            //初始化滑块拖动功能
            _initSliderDragEvent:function(){
                var self=this;
                var slider=self.$slider;
                var sliderEl=slider[0];
                if(sliderEl){
                    var doc=self.$doc,
                    dragStartPagePosition,
                    dragStartScrollPosition,
                    dragContBarRate;
                    function mousemoveHandler(e){
                        e.preventDefault();
                        console.log('move')
                        if(dragStartPagePosition==null){
                            return;
                        }
                        self.scrollTo(dragStartPagePosition+(e.pageY-dragStartPagePosition)*dragContBarRate)
                    }
                    slider.on('mousedown',function(e){
                        e.preventDefault();
                        console.log(this)
                        dragStartPagePosition=e.pageY;
                        dragStartScrollPosition=self.$cont[0].scrollTop;
                        dragContBarRate=self.getMaxScrollPosition()/self.getMaxSliderPostion();
                        doc.on('mousemove.scroll',mousemoveHandler).on('mouseup.scroll',function(e){
                            console.log('up')
                            doc.off('.scroll');
                        });
                    });
                }
                return self;
            },
            /*初始化标签功能*/
            _initTabEvent:function(){
                var self=this;
                self.$tabItem.on('click',function(e){
                    e.preventDefault;
                    console.log('tab')
                    var index=$(this).index();
                    self.changeTabSelect(index);
                    //已经滚出可视区内容的高度+指定锚点与内容容器的距离
                    self.scrollTo(self.$cont[0].scrollTop+self.getAnchorPosition(index));
                });
                return self;
            },
            //切换标签的选中
            changeTabSelect:function(index){
                var self=this,
                active=self.options.tabActiveClass;
                return self.$tabItem.eq(index).addClass(active).siblings().removeClass(active);
            },
            //获取指定锚点到上边界的像素数
            getAnchorPosition:function(index){
                return this.$anchor.eq(index).position().top;
            },
            //获取每个锚点位置信息的数组
            getAllAnchorPosition:function(){
                var self=this,
                allPositionArr=[];
                for(var i=0;i<self.$anchor.length;i++){
                    allPositionArr.push(self.$cont[0].scrollTop+self.getAnchorPosition(i));
                };
                return allPositionArr;
            },
            //内容可滚动高度
            getMaxScrollPosition:function(){
                var self=this;
                return Math.max(self.$cont.height(),self.$cont[0].scrollHeight)-self.$cont.height();
                //如果内容没有超过内容区，则可滚动高度为0
            },
            _bindMouseWheel:function(){
                var self=this;
                self.$cont.on('mousewheel DOMMouseScroll',function(e){
                    e.preventDefault();
                    var oEv=e.originalEvent,
                    wheelRange=oEv.wheelDelta?-oEv.wheelDelta/120:(oEv.detail||0)/3;
                    self.scrollTo(self.$cont[0].scrollTop+wheelRange*self.options.wheelStep)
                });
                return self;
            },
            //计算滑块的当前位置
            getSliderPostion:function(){
                var self = this;
                var maxSliderPosition=self.getMaxSliderPostion();
                return Math.min(maxSliderPosition,maxSliderPosition*self.$cont[0].scrollTop/self.getMaxScrollPosition());
            },
            //滑块可移动距离
            getMaxSliderPostion:function(){
                var self=this;
                return self.$bar.height()-self.$slider.height();
            },
            scrollTo:function(positionVal){
                var self=this;
                var posArr=self.getAllAnchorPosition();
                //滚动条位置与tab标签对应
                function getIndex(positionVal){
                    for(var i=posArr.length-1;i>=0;i--){
                        if(positionVal>=posArr[i]){
                            return i;
                        }else{
                            continue;
                        }
                    };
                };
                   //锚点数与标签数相同
                    if(posArr.length==self.$tabItem.length){
                        self.changeTabSelect(getIndex(positionVal));
                    }
                self.$cont.scrollTop(positionVal);
            },
            //监听内容的滚动，同步滑块的距离。
            _bindContScroll:function(){
                var self=this;
                self.$cont.on('scroll',function(){
                    var sliderEl=self.$slider&&self.$slider[0];
                    if(sliderEl){
                        sliderEl.style.top=self.getSliderPostion()+'px';
                    };
                });
                return self;
            }
        });
        srcoll.cusScrollBar=cusScrollBar
    })(window,document,jQuery);
    new srcoll.cusScrollBar({
                    contSelector:".scroll-cont",//滚动内容区选择器
                    barSelector:".scroll-bar",//滚动条选择器
                    sliderSelector:".scroll-slider"//滚动滑块选择器
                });
</script>

</body>
</html>